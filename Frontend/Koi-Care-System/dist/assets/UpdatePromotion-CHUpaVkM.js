import{e as I,d as B,u as q,r as i,j as t,a as b,B as x}from"./index-Qtd3etr3.js";import{L as C,H as z}from"./LeftSideBar-CO1q3EiE.js";import{T as A}from"./TopLayoutShop-B26udbzX.js";import{a as L}from"./index.esm-9so3oJW4.js";import{S as M}from"./react-select.esm-Dji3pTeU.js";import{i as T}from"./react-select-animated.esm-CIqWClGq.js";import"./index-Ds6Ab8W8.js";import"./index-DF6yzlP_.js";import"./index-CdZqjTQo.js";/* empty css            */import"./logo-DG-ZgLhE.js";import"./toPropertyKey-PLuKRk1e.js";function ee(){const w=T(),{id:d}=I(),{isDarkMode:r}=B(),N=q(),[h,g]=i.useState(!1),[O,u]=i.useState(!0),[n,v]=i.useState(null),[F,k]=i.useState([]);i.useState([]);const[l,m]=i.useState([]),{register:c,handleSubmit:j,formState:{errors:s},reset:D,watch:p}=L(),y=async e=>{try{const a=localStorage.getItem("token");if(!a)throw new Error("No token found");const o=await b.get(`https://koicaresystemv2.azurewebsites.net/api/promotions/${e}/products/view`,{headers:{Authorization:`Bearer ${a}`}});console.log("Product details response:",o.data.data),o.data&&o.data.data?m(o.data.data.map(f=>f.id)):m([])}catch(a){console.log("Error fetching product details:",a),m([])}},S=async()=>{u(!0);try{const e=localStorage.getItem("token");if(!e)throw new Error("No token found");const a=await b.get(`https://koicaresystemv2.azurewebsites.net/api/promotions/promotion/${d}`,{headers:{Authorization:`Bearer ${e}`}});v(a.data.data)}catch(e){console.error("Error fetching Promotion:",e),x.error("Failed to fetch Promotion details.")}finally{u(!1)}};i.useEffect(()=>{d&&(y(d),S())},[d]);const E=async()=>{try{const e=localStorage.getItem("token");if(!e)throw new Error("No token found");const o=(await b.get("https://koicaresystemv2.azurewebsites.net/api/products/all",{headers:{Authorization:`Bearer ${e}`}})).data.data.filter(f=>f.id>3);k(o)}catch(e){console.log("Error fetching products:",e)}};i.useEffect(()=>{E()},[]),i.useEffect(()=>{n&&D({name:n.name,startDate:n.startDate,endDate:n.endDate,discountRate:n.discountRate,description:n.description,status:n.status,productIds:l})},[n,D,l]);const P=async e=>{u(!0),g(!0);try{const a=localStorage.getItem("token");if(!a)throw new Error("No token found");const o=await b.put(`https://koicaresystemv2.azurewebsites.net/api/promotions/promotion/${d}/update`,{id:d,name:e.name,startDate:e.startDate,endDate:e.endDate,discountRate:e.discountRate,description:e.description,status:e.status,productIds:l},{headers:{Authorization:`Bearer ${a}`}});x.success("Promotion updated successfully!"),N("/shop/promotion")}catch(a){console.log(a),x.error("Failed to update Promotion.")}finally{g(!1),u(!1)}},$=e=>{const a=new Date(e.startDate),o=new Date(e.endDate);if(a>o){x.error("Start date cannot be after end date."),g(!1);return}P(e)},R=e=>{m(e?e.map(a=>a.value):[])};return t.jsxs("div",{className:"h-screen flex",children:[t.jsx(C,{}),t.jsxs("div",{className:`relative ${r?"bg-custom-light text-white":"bg-white text-black"} overflow-y-auto flex-1 flex-col  overflow-x-hidden duration-200 ease-linear`,children:[t.jsx(z,{}),t.jsxs("div",{className:"py-5 pb-0 px-[30px] mx-auto",children:[t.jsx(A,{text:"Promotion",textName:"Update Promotion",links:"shop/promotion"}),t.jsx("div",{className:"p-6 rounded-md border",children:t.jsxs("form",{onSubmit:j($),noValidate:!0,children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"name",className:"block text-sm font-medium mb-2",children:"Promotion Name"}),t.jsx("input",{type:"text",id:"name",className:`relative w-full p-2 border rounded-md ${r?"bg-custom-dark text-white":"bg-white text-black"}
                    ${s.tagName?"border-red-500":"border-gray-300"}`,...c("name",{required:"Name is required",minLength:{value:2,message:"Name must be at least 2 characters long"},maxLength:{value:50,message:"Name must not exceed 50 characters"}})}),s.name&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.name.message})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-bold mb-2",children:"Select Products"}),t.jsx(M,{isMulti:!0,options:F.map(e=>({value:e.id,label:e.name})),value:F.filter(e=>l.includes(e.id)).map(e=>({value:e.id,label:e.name})),onChange:R,className:`border ${l.length===0?"border-red-500":"border-gray-300"}`,closeMenuOnSelect:!1,components:w,styles:{control:e=>({...e,backgroundColor:r?"#1F2937":"#FFFFFF",color:r?"#FFFFFF":"#000000",borderColor:s.tags?"#EF4444":"#D1D5DB","&:hover":{borderColor:s.tags?"#EF4444":"#9CA3AF"}}),menu:e=>({...e,backgroundColor:r?"#1F2937":"#FFFFFF"}),option:(e,a)=>({...e,backgroundColor:a.isFocused?r?"#374151":"#E5E7EB":r?"#1F2937":"#FFFFFF",color:r?"#FFFFFF":"#000000"}),multiValue:e=>({...e,backgroundColor:r?"#4B5563":"#E5E7EB",color:r?"#FFFFFF":"#000000"})}}),l.length===0&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:"At least one product is required"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"startDate",className:"block text-sm font-medium mb-2",children:"Start Date"}),t.jsx("input",{type:"datetime-local",id:"startDate",className:`relative w-full p-2 border rounded-md ${r?"bg-custom-dark text-white":"bg-white text-black"}
                    ${s.startDate?"border-red-500":"border-gray-300"}`,...c("startDate",{required:"Start Date is required"}),min:new Date().toISOString().split("T")[0],max:p("endDate")?new Date(p("endDate")).toISOString().split("T")[0]:void 0}),s.startDate&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.startDate.message})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"endDate",className:"block text-sm font-medium mb-2",children:"End Date"}),t.jsx("input",{type:"datetime-local",id:"endDate",className:`relative w-full p-2 border rounded-md ${r?"bg-custom-dark text-white":"bg-white text-black"}
                    ${s.endDate?"border-red-500":"border-gray-300"}`,...c("endDate",{required:"End Date is required"}),min:p("startDate")?new Date(p("startDate")).toISOString().split("T")[0]:void 0}),s.endDate&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.endDate.message})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"discountRate",className:"block text-sm font-medium mb-2",children:"Discount Rate"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"number",id:"discountRate",className:`relative w-full p-2 border rounded-md pr-10 ${r?"bg-custom-dark text-white":"bg-white text-black"}
                      ${s.discountRate?"border-red-500":"border-gray-300"}`,...c("discountRate",{required:"Discount Rate is required",min:{value:0,message:"Discount Rate cannot be less than 0%"},max:{value:100,message:"Discount Rate cannot exceed 100%"}})}),t.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"%"})]}),s.discountRate&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.discountRate.message})]}),t.jsxs("div",{className:"mb-4 ",children:[t.jsx("label",{htmlFor:"description",className:"block text-sm font-medium mb-2",children:"Description"}),t.jsx("textarea",{rows:"6",id:"description",className:`relative w-full  border rounded-md ${r?"bg-custom-dark text-white":"bg-white text-black"}
                    ${s.tagName?"border-red-500":"border-gray-300"}`,...c("description")})]}),t.jsx("div",{className:"mb-4 ",children:t.jsx("input",{type:"hidden",id:"status",className:`relative w-full  border rounded-md ${s.tagName?"border-red-500":"border-gray-300"}`,...c("status")})}),t.jsx("button",{type:"submit",className:`px-4 py-2 bg-blue-600 text-white rounded-md ${h?"opacity-50 cursor-not-allowed":"hover:bg-blue-700"}`,disabled:h,children:h?"Submitting...":"Update Promotion"})]})})]})]})]})}export{ee as default};
